### Process flow in CQRS

Now that the concepts of CQRS are described, let's put the pieces together and see how they work by an example. The whole CQRS design is shown in Figure X**reference needed** in detail.

Let's begin with a command which is sent from the user interface, e.g. '*add product to user's cart*'. The command is received by the application and validated. Then, the command handler for that command is found and handles the command. The command handler retrieves the aggregate instance that the command targets, e.g. a *Cart*, from a data access object (usually called a repository). The aggregate processes the command in its method invoked by the handler. The method, for example, adds the product to some internal data representation, or if the product is already present in the cart, it updates the product quantity. With each state change, a domain event which describes the state transition is published by the aggregate. When the command is finished, the aggregate is saved to the repository again, and if successful (i.e. no error was raised), the events are sent to the event handlers. The events can be sent to sagas (a special type of event handler), or any other handlers, e.g. read model builders or messaging that integrates other systems.